<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.api.manager.db.board.mapper.BoardMapper">

    <select id="selectBoard" resultType="kr.co.api.manager.db.board.model.DataModel">
        SELECT
              board_no
              , board_kind
              , board_title
              , board_content
              , board_writer
            --  , reply_no
              , reply_content
              , reply_sort
              , reply_depth
              , reg_date
              , chg_date
        FROM board
        WHERE 1 = 1
        ORDER BY board_no DESC, reply_sort ASC
        LIMIT 10
    </select>

    <insert id="insertBoard" parameterType="kr.co.api.manager.db.board.model.BoardModel">
        INSERT INTO board (board_kind, board_no, board_title, board_content, board_writer, reg_date, chg_date )
        VALUES (
                #{boardKind}
                , (SELECT IFNULL(MAX(b.board_no)+1, 0) FROM board b WHERE b.board_kind = #{boardKind})
                , #{boardTitle}
                , #{boardContent}
                , #{boardWriter}
                , NOW()
                , NOW()
                )
    </insert>

    <!--
    댓글의 댓글이면 댓글의 현재 깊이 값을 넘겨야함 그래야 +1함
    -->
    <insert id="insertReply" parameterType="kr.co.api.manager.db.board.model.ReplyModel">
        INSERT INTO board (board_kind, board_no, reply_content, reply_sort, reply_depth, reg_date, chg_date)
        VALUES (
                #{boardKind}
                , #{boardNo}
                , #{replyContent}
                , #{replySort}
                , #{replyDepth}
                , NOW()
                , NOW()
                )
    </insert>

    <insert id="updateTest" parameterType="kr.co.api.manager.db.test.model.Test">
        UPDATE test
        SET
            text = #{text}
        WHERE id = #{id}
    </insert>

    <delete id="deleteTest">
        DELETE FROM test WHERE id = #{id}
    </delete>
</mapper>